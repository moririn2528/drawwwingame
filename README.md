# drawwingame

絵を描くゲーム

## 詳細
ユーザーはログインし、いずれかのグループに入る。すると、グループの待機室に入る。全員の準備が整い次第ゲームが始まる。ゲームは何回かのターン制。それぞれのターンでは、まずユーザーが書き手と回答者に分かれる。書き手はチャットで何を書くか決める。決まれば時間制限のタイマーがスタートし、絵をかいて時間内に回答者がお題を言い当てれば勝ちとなる。

### お絵描きの森との違い
お題に何かわからないものが出てくることが多い。調べて書いたとしても回答者も知らない、みたいなことがよくある。ユーザーでお題を選ぶことによって、グループ共通の常識がわかり、どういうのがちょうどいい難易度で皆知っているのかわかるため、より楽しめると思われる。

このために、お題を回答者がチャットで言い当てても、サーバーによって判定が下されない。書き手全員が正解ボタンを押すことによって言い当てたという判定がなされる。

# 技術選定
複数のユーザーとリアルタイム通信をする、並列処理でほかの言語より速くかける言語、Go 言語を用いる。

クリーンアーキテクチャを用いたかったが、実装しようとすると、この関数をどこに置けばいいのか、コード量が爆発しそうである、など不安要素が多く実装しきれないと思ったのであきらめた。あとで時間があればやりたい。

サーバーサイドをメインにしたい。レイヤードアーキテクチャ+ドメインモデルで作る。
フロント側はMVC、処理はほぼサーバー側に任せる。

## 依存の解釈について
内部は外部のことを知らないようにする、と言っているが、実際に書こうとすると、外部を書いているときにこの機能が欲しい→ interface を書くので依存している。
したがって、"依存(A→B)" は、B を取り除いたときに A は実行できず、A を取り除いたとしても B を実行できるものの関係、とした。

# 感想など
## 得られたこと
- 初めて設計、技術選定をしてコードを書いた。設計して書いていくと、改善するときにどの関数がどこにあるのか、どのへんで間違っているのかがある程度見当つくので修正はしやすかった。しかし、コード量が多くなり、計算量も定数倍増えていて、減らすことはできないと思う。

- 逆依存は最初意味不明だと思っていたが、書いていくと理解していき、勝手に逆依存になるようなコードを書けるようになった。

- 初めてフロント側もある程度作成した。思っていた機能は断念することなくつけることができた。

- websocket を初めて使った。入力、出力のパラメータはすべて統一するようにした。

- sql の呼び出し回数がユーザー数などに依存しない、定数となるようにした。

## まだ残っていること
- 予想に反するクエリに対してまだ弱い。checker をつよくする。
- sql をたたく回数が多いものを redis にする。

- 実装する前は気付かなかったが、絵の message は大量だが呼ばれることは少なく、チャットメッセージの message は少ないが check を強くするには多く呼ぶ必要がある。この 2 つを同じテーブルに入れているので、分けて、チャットメッセージの方を redis に乗せる。ゲーム終了後 redis からデータベースに移す、みたいなことをしたい。

- グループ内で admin ユーザーを作り、ユーザー自身がゲームの詳細を決めることができるようにしたい。

- クリーンアーキテクチャを使う。


# 規定

## メールアドレス
RFC 5321, 5322 に準じたもののみに制限

## パスワード
16 進数 長さは 6 文字以上 100 文字以下

`!@#$%&*()` と大文字小文字アルファベット、数字のみ使用可能。長さは 6 文字以上 50 文字以下(長さ制約は未実装)

## name
バイト長 30 文字以下、日本語可